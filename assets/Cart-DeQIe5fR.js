import{e as S,r as l,j as e,w as H,x as P,d as y,y as I,z as k,A as v,B as F,D as A,E as C}from"./index-Bj6IjsBP.js";import{J as p,p as g,S as E,K as L,H as O}from"./Heading-CiWTgu_3.js";import{L as T}from"./Loading-C3ILP6OL.js";import"./Row-CkZGBLgn.js";const B="_container_1r8sz_1",b={container:B},R=({products:t,UserAccesToken:c})=>{const r=S(),[n,a]=l.useState(!1),[o,i]=l.useState(!1),[h,m]=l.useState(null),d=()=>{a(!n),m(null)},s=()=>{i(!0),r(H(u)).unwrap().then(()=>{r(P()),a(!1)}).catch(x=>{m(x)}).finally(()=>{i(!1)})},u=t.reduce((x,f)=>{const w=f.price,j=f.quantity;return j&&typeof j=="number"?x+w*j:x},0);return e.jsxs(e.Fragment,{children:[e.jsxs(p,{show:n,onHide:d,backdrop:"static",children:[e.jsx(p.Header,{closeButton:!0,children:e.jsx(p.Title,{children:"Placing Order"})}),e.jsxs(p.Body,{children:["Are you sure you want to place order with subtotal",e.jsxs("span",{className:"fw-bold",children:[" ",u.toFixed(2)," EGP"]}),!o&&h&&e.jsx("p",{style:{color:"#dc3545",marginTop:"10px"},children:h})]}),e.jsxs(p.Footer,{children:[e.jsx(g,{variant:"secondary",onClick:d,children:"Close"}),e.jsx(g,{variant:"info",style:{color:"white"},onClick:s,children:o?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",animation:"border"})," Loading..."]}):"Confirm"})]})]}),e.jsxs("div",{className:b.container,children:[e.jsx("span",{children:"Subtotal: "}),e.jsxs("span",{children:[u.toFixed(2)," EGP"]})]}),c&&e.jsxs("div",{className:b.container,children:[e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx(g,{variant:"info",style:{color:"white"},onClick:d,children:"Place Order"})})]})]})},q=({products:t,changeQuantityHandler:c,RemoveItemHandler:r})=>{const n=t.map(a=>e.jsx(L,{...a,changeQuantityHandler:c,RemoveItemHandler:r},a.id));return e.jsx("div",{children:n})},z=()=>{const t=S(),{items:c,productsFullInfo:r,loading:n,error:a}=y(s=>s.cart),o=y(s=>s.auth.accessToken),i=y(s=>s.orders.loading);l.useEffect(()=>{const s=t(I());return()=>{s.abort(),t(k()),t(v())}},[t]);const h=r.map(s=>({...s,quantity:c[s.id]})),m=l.useCallback((s,u)=>{t(F({id:s,quantity:u}))},[t]),d=l.useCallback(s=>{t(A(s))},[t]);return{loading:n,error:a,products:h,UserAccesToken:o,PlaceOrderStatus:i,changeQuantityHandler:m,RemoveItemHandler:d}},D=()=>{const{loading:t,error:c,products:r,UserAccesToken:n,PlaceOrderStatus:a,changeQuantityHandler:o,RemoveItemHandler:i}=z();return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Your Cart"}),e.jsx(T,{loading:t,error:c,type:"cart",children:r.length?e.jsxs(e.Fragment,{children:[e.jsx(q,{products:r,changeQuantityHandler:o,RemoveItemHandler:i}),e.jsx(R,{products:r,UserAccesToken:n})]}):a==="succeeded"?e.jsx(C,{type:"success",message:"Your order has been placed successfully",style:{width:"350px",margin:"auto",textAlign:"center"}}):e.jsx(C,{type:"Empty",message:"your cart is empty",style:{width:"400px"}})})]})};export{D as default};
